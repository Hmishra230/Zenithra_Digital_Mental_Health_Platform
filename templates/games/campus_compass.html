{% extends 'base.html' %}
{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-4xl font-bold text-blue-800 mb-4">üß≠ Campus Compass</h1>
        <p class="text-lg text-gray-600 mb-8 hindi-text">‡§ï‡•à‡§Ç‡§™‡§∏ ‡§ï‡§Ç‡§™‡§æ‡§∏ - Explore your virtual campus and discover wellness resources</p>
        
        <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
            <div class="campus-map-container mb-6">
                <div id="campus-map" class="relative bg-green-100 rounded-lg overflow-hidden">
                    <!-- Campus buildings and resources will be rendered here -->
                </div>
            </div>
            
            <div class="navigation-controls mb-6">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button class="nav-btn active" data-category="all">
                        üèõÔ∏è All Locations
                    </button>
                    <button class="nav-btn" data-category="health">
                        üè• Health Services
                    </button>
                    <button class="nav-btn" data-category="wellness">
                        üßò‚Äç‚ôÄÔ∏è Wellness Centers
                    </button>
                    <button class="nav-btn" data-category="support">
                        ü§ù Support Services
                    </button>
                </div>
            </div>
            
            <div class="discovery-stats grid grid-cols-3 gap-4 text-center mb-6">
                <div>
                    <div id="locations-found" class="text-2xl font-bold text-blue-600">0</div>
                    <div class="text-sm text-gray-600">Locations Found</div>
                </div>
                <div>
                    <div id="resources-unlocked" class="text-2xl font-bold text-green-600">0</div>
                    <div class="text-sm text-gray-600">Resources Unlocked</div>
                </div>
                <div>
                    <div id="exploration-level" class="text-2xl font-bold text-purple-600">1</div>
                    <div class="text-sm text-gray-600">Explorer Level</div>
                </div>
            </div>
        </div>
        
        <!-- Resource Detail Modal -->
        <div id="resource-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl p-8 max-w-lg mx-4">
                <div class="flex justify-between items-start mb-4">
                    <h3 id="modal-title" class="text-xl font-bold text-gray-800"></h3>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div id="modal-content" class="text-gray-700">
                    <!-- Resource details will be populated here -->
                </div>
                <div class="mt-6 flex justify-end">
                    <button id="bookmark-resource" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded mr-2">
                        üìå Bookmark
                    </button>
                    <button id="get-directions" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                        üó∫Ô∏è Get Directions
                    </button>
                </div>
            </div>
        </div>
        
        <div class="text-center">
            <a href="/game_zone" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-lg font-semibold">
                Back to Game Zone
            </a>
        </div>
    </div>
</div>

<style>
#campus-map {
    width: 100%;
    height: 400px;
    background-image: 
        radial-gradient(circle at 20% 80%, #c7f0db 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, #b3e5fc 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, #fff3e0 0%, transparent 50%),
        linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
    border: 2px solid #3b82f6;
}

.campus-building {
    position: absolute;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.campus-building:hover {
    transform: scale(1.1);
    z-index: 10;
}

.campus-building.discovered {
    border: 3px solid #fbbf24;
    animation: glow 2s ease-in-out infinite;
}

@keyframes glow {
    0%, 100% { box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    50% { box-shadow: 0 4px 16px rgba(251, 191, 36, 0.5); }
}

.resource-marker {
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid white;
    transition: all 0.3s ease;
    animation: pulse 2s ease-in-out infinite;
}

.resource-marker:hover {
    transform: scale(1.3);
}

@keyframes pulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

.nav-btn {
    padding: 0.75rem;
    border: 2px solid #e5e7eb;
    border-radius: 0.75rem;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem;
}

.nav-btn:hover {
    border-color: #3b82f6;
    background: #eff6ff;
}

.nav-btn.active {
    border-color: #3b82f6;
    background: #3b82f6;
    color: white;
}

.discovery-badge {
    position: fixed;
    top: 4rem;
    right: 1rem;
    background: #10b981;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: bold;
    animation: slideIn 0.5s ease-out;
    z-index: 1000;
}

@keyframes slideIn {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}
</style>

<script>
class CampusCompass {
    constructor() {
        this.campusData = {
            buildings: [
                {
                    id: 'library',
                    name: 'Central Library',
                    x: 15, y: 25,
                    width: 120, height: 80,
                    color: '#8b5cf6',
                    category: 'academic',
                    discovered: false
                },
                {
                    id: 'health-center',
                    name: 'Health Center',
                    x: 250, y: 50,
                    width: 100, height: 60,
                    color: '#ef4444',
                    category: 'health',
                    discovered: false
                },
                {
                    id: 'wellness-center',
                    name: 'Wellness Center',
                    x: 400, y: 180,
                    width: 110, height: 70,
                    color: '#10b981',
                    category: 'wellness',
                    discovered: false
                },
                {
                    id: 'counseling',
                    name: 'Counseling Services',
                    x: 180, y: 200,
                    width: 100, height: 60,
                    color: '#f59e0b',
                    category: 'support',
                    discovered: false
                },
                {
                    id: 'student-center',
                    name: 'Student Center',
                    x: 50, y: 150,
                    width: 100, height: 80,
                    color: '#3b82f6',
                    category: 'support',
                    discovered: false
                },
                {
                    id: 'gym',
                    name: 'Fitness Center',
                    x: 350, y: 80,
                    width: 90, height: 60,
                    color: '#dc2626',
                    category: 'wellness',
                    discovered: false
                }
            ],
            resources: [
                {
                    id: 'counselor-office',
                    name: 'Dr. Priya Sharma - Counselor',
                    x: 230, y: 230,
                    category: 'support',
                    color: '#f59e0b',
                    description: 'Professional counseling services for students dealing with stress, anxiety, and other mental health concerns.',
                    contact: 'Phone: 9152987821, Email: priya.sharma@college.edu',
                    hours: 'Monday-Friday: 9AM-5PM',
                    services: ['Individual Counseling', 'Group Therapy', 'Crisis Intervention'],
                    discovered: false
                },
                {
                    id: 'meditation-room',
                    name: 'Meditation & Mindfulness Room',
                    x: 450, y: 220,
                    category: 'wellness',
                    color: '#10b981',
                    description: 'Quiet space for meditation, mindfulness practices, and relaxation techniques.',
                    contact: 'Open access during wellness center hours',
                    hours: 'Daily: 6AM-10PM',
                    services: ['Guided Meditation', 'Mindfulness Sessions', 'Relaxation Techniques'],
                    discovered: false
                },
                {
                    id: 'peer-support',
                    name: 'Peer Support Group',
                    x: 100, y: 200,
                    category: 'support',
                    color: '#3b82f6',
                    description: 'Student-led support groups for various mental health topics and life challenges.',
                    contact: 'Email: peer.support@college.edu',
                    hours: 'Tuesdays & Thursdays: 6PM-8PM',
                    services: ['Peer Counseling', 'Support Groups', 'Mental Health Workshops'],
                    discovered: false
                },
                {
                    id: 'crisis-hotline',
                    name: '24/7 Crisis Helpline',
                    x: 300, y: 80,
                    category: 'health',
                    color: '#ef4444',
                    description: 'Emergency mental health support available 24/7 for students in crisis.',
                    contact: 'Crisis Hotline: 1800-599-0019',
                    hours: '24/7 - Always Available',
                    services: ['Crisis Intervention', 'Emergency Support', 'Suicide Prevention'],
                    discovered: false
                },
                {
                    id: 'yoga-classes',
                    name: 'Yoga & Wellness Classes',
                    x: 380, y: 120,
                    category: 'wellness',
                    color: '#10b981',
                    description: 'Regular yoga classes and wellness workshops to promote physical and mental health.',
                    contact: 'Register at wellness center',
                    hours: 'Daily classes: 7AM, 12PM, 6PM',
                    services: ['Hatha Yoga', 'Stress Relief Yoga', 'Wellness Workshops'],
                    discovered: false
                },
                {
                    id: 'study-wellness',
                    name: 'Academic Stress Support',
                    x: 65, y: 55,
                    category: 'support',
                    color: '#8b5cf6',
                    description: 'Specialized support for academic stress, exam anxiety, and study-related mental health issues.',
                    contact: 'Book appointments through library',
                    hours: 'Monday-Friday: 10AM-4PM',
                    services: ['Study Skills', 'Exam Anxiety Support', 'Academic Counseling'],
                    discovered: false
                }
            ]
        };
        
        this.currentFilter = 'all';
        this.discoveredLocations = 0;
        this.discoveredResources = 0;
        this.explorationLevel = 1;
        
        this.initializeGame();
        this.loadProgress();
        this.renderCampus();
        this.updateStats();
    }
    
    initializeGame() {
        this.setupEventListeners();
        this.bindModal();
    }
    
    setupEventListeners() {
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                this.setFilter(btn.dataset.category);
            });
        });
    }
    
    bindModal() {
        document.getElementById('close-modal').addEventListener('click', () => {
            this.hideModal();
        });
        
        document.getElementById('bookmark-resource').addEventListener('click', () => {
            this.bookmarkResource();
        });
        
        document.getElementById('get-directions').addEventListener('click', () => {
            this.getDirections();
        });
        
        // Close modal on background click
        document.getElementById('resource-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('resource-modal')) {
                this.hideModal();
            }
        });
    }
    
    renderCampus() {
        const map = document.getElementById('campus-map');
        map.innerHTML = '';
        
        // Render buildings
        this.campusData.buildings.forEach(building => {
            if (this.currentFilter === 'all' || building.category === this.currentFilter) {
                const buildingEl = this.createBuildingElement(building);
                map.appendChild(buildingEl);
            }
        });
        
        // Render resources
        this.campusData.resources.forEach(resource => {
            if (this.currentFilter === 'all' || resource.category === this.currentFilter) {
                const resourceEl = this.createResourceElement(resource);
                map.appendChild(resourceEl);
            }
        });
    }
    
    createBuildingElement(building) {
        const buildingEl = document.createElement('div');
        buildingEl.className = `campus-building ${building.discovered ? 'discovered' : ''}`;
        buildingEl.style.left = building.x + 'px';
        buildingEl.style.top = building.y + 'px';
        buildingEl.style.width = building.width + 'px';
        buildingEl.style.height = building.height + 'px';
        buildingEl.style.backgroundColor = building.color;
        buildingEl.textContent = building.name;
        
        buildingEl.addEventListener('click', () => {
            this.discoverBuilding(building);
        });
        
        return buildingEl;
    }
    
    createResourceElement(resource) {
        const resourceEl = document.createElement('div');
        resourceEl.className = `resource-marker ${resource.discovered ? 'discovered' : ''}`;
        resourceEl.style.left = resource.x + 'px';
        resourceEl.style.top = resource.y + 'px';
        resourceEl.style.backgroundColor = resource.color;
        resourceEl.title = resource.name;
        
        resourceEl.addEventListener('click', () => {
            this.discoverResource(resource);
        });
        
        return resourceEl;
    }
    
    discoverBuilding(building) {
        if (!building.discovered) {
            building.discovered = true;
            this.discoveredLocations++;
            this.showDiscoveryBadge(`Discovered: ${building.name}!`);
            this.checkLevelUp();
            this.saveProgress();
            this.updateStats();
            this.renderCampus();
        }
    }
    
    discoverResource(resource) {
        if (!resource.discovered) {
            resource.discovered = true;
            this.discoveredResources++;
            this.showDiscoveryBadge(`Found: ${resource.name}!`);
            this.checkLevelUp();
            this.saveProgress();
            this.updateStats();
        }
        
        this.showResourceModal(resource);
        this.renderCampus();
    }
    
    showResourceModal(resource) {
        document.getElementById('modal-title').textContent = resource.name;
        
        const content = document.getElementById('modal-content');
        content.innerHTML = `
            <div class="mb-4">
                <p class="mb-3">${resource.description}</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <h5 class="font-semibold text-gray-800 mb-2">üìû Contact:</h5>
                        <p class="text-sm">${resource.contact}</p>
                    </div>
                    <div>
                        <h5 class="font-semibold text-gray-800 mb-2">üïê Hours:</h5>
                        <p class="text-sm">${resource.hours}</p>
                    </div>
                </div>
                
                <div>
                    <h5 class="font-semibold text-gray-800 mb-2">üîß Services:</h5>
                    <ul class="list-disc list-inside text-sm space-y-1">
                        ${resource.services.map(service => `<li>${service}</li>`).join('')}
                    </ul>
                </div>
            </div>
        `;
        
        document.getElementById('resource-modal').classList.remove('hidden');
        
        // Store current resource for actions
        this.currentResource = resource;
    }
    
    hideModal() {
        document.getElementById('resource-modal').classList.add('hidden');
        this.currentResource = null;
    }
    
    bookmarkResource() {
        if (this.currentResource) {
            const bookmarks = JSON.parse(localStorage.getItem('campusBookmarks') || '[]');
            if (!bookmarks.find(b => b.id === this.currentResource.id)) {
                bookmarks.push(this.currentResource);
                localStorage.setItem('campusBookmarks', JSON.stringify(bookmarks));
                this.showDiscoveryBadge('Resource Bookmarked!');
            }
        }
    }
    
    getDirections() {
        if (this.currentResource) {
            this.showDiscoveryBadge(`Directions: Located at coordinates (${this.currentResource.x}, ${this.currentResource.y})`);
        }
    }
    
    setFilter(category) {
        this.currentFilter = category;
        
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.querySelector(`[data-category="${category}"]`).classList.add('active');
        
        this.renderCampus();
    }
    
    showDiscoveryBadge(message) {
        const badge = document.createElement('div');
        badge.className = 'discovery-badge';
        badge.textContent = message;
        document.body.appendChild(badge);
        
        setTimeout(() => {
            badge.remove();
        }, 3000);
    }
    
    checkLevelUp() {
        const totalDiscoveries = this.discoveredLocations + this.discoveredResources;
        const newLevel = Math.floor(totalDiscoveries / 5) + 1;
        
        if (newLevel > this.explorationLevel) {
            this.explorationLevel = newLevel;
            this.showDiscoveryBadge(`üéâ Explorer Level Up! Now Level ${this.explorationLevel}!`);
        }
    }
    
    updateStats() {
        document.getElementById('locations-found').textContent = this.discoveredLocations;
        document.getElementById('resources-unlocked').textContent = this.discoveredResources;
        document.getElementById('exploration-level').textContent = this.explorationLevel;
    }
    
    saveProgress() {
        const progress = {
            campusData: this.campusData,
            discoveredLocations: this.discoveredLocations,
            discoveredResources: this.discoveredResources,
            explorationLevel: this.explorationLevel
        };
        localStorage.setItem('campusCompassProgress', JSON.stringify(progress));
    }
    
    loadProgress() {
        const saved = localStorage.getItem('campusCompassProgress');
        if (saved) {
            const progress = JSON.parse(saved);
            if (progress.campusData) {
                // Merge discovered status
                progress.campusData.buildings.forEach((savedBuilding, index) => {
                    if (this.campusData.buildings[index]) {
                        this.campusData.buildings[index].discovered = savedBuilding.discovered;
                    }
                });
                
                progress.campusData.resources.forEach((savedResource, index) => {
                    if (this.campusData.resources[index]) {
                        this.campusData.resources[index].discovered = savedResource.discovered;
                    }
                });
            }
            
            this.discoveredLocations = progress.discoveredLocations || 0;
            this.discoveredResources = progress.discoveredResources || 0;
            this.explorationLevel = progress.explorationLevel || 1;
        }
    }
}

// Initialize the game
document.addEventListener('DOMContentLoaded', () => {
    new CampusCompass();
});
</script>
{% endblock %}
